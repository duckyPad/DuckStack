REM *** DuckyScript Compiler Torture Test ***
REM This script tests various aspects of the language specification.

// ---------------------------------------------------------
// 1. CONSTANTS & GLOBALS
// ---------------------------------------------------------
DEFINE START_MSG Starting_Test...
DEFINE TEST_VAL 10

VAR global_counter = 0
VAR bit_flags = 0

// ---------------------------------------------------------
// 2. FUNCTIONS
// ---------------------------------------------------------
FUNCTION complex_math(arg1, arg2)
    // Test Local Variables & Scope shadowing
    VAR local_res = 0
    
    // Test Arithmetic Precedence: (arg1 * 2) + (arg2 / 5)
    local_res = arg1 * 2
    local_res = local_res + arg2 / 5
    
    // Update global from inside function
    global_counter = global_counter + 1
    
    RETURN local_res
END_FUNCTION

// ---------------------------------------------------------
// 3. MAIN LOGIC & CONTROL FLOW
// ---------------------------------------------------------

// Test String Blocks
STRINGLN_BLOCK
[TEST] String Block Check.
If you see this, blocks work.
END_STRINGLN

STRINGLN START_MSG

// Test Loops and Conditionals
VAR i = 0
WHILE i < 5
    // Test Logical AND (&&) inside expression
    IF i > 0 && i < 4 THEN
        STRING .
    END_IF
    
    // Test LBREAK
    IF i == 4 THEN
        STRINGLN [OK] Loop Finished.
        LBREAK
    END_IF
    
    i = i + 1
    DELAY 10
END_WHILE

// ---------------------------------------------------------
// 4. ARITHMETIC & BITWISE
// ---------------------------------------------------------

// Test Bitwise Shifts and Logic
// 1 shifted left 4 times is 16
bit_flags = 1 << 4 
VAR mask_check = bit_flags | 1
// Result should be 17

// Test Function Call with Expressions as arguments
VAR math_result = 0
math_result = complex_math(TEST_VAL, 100)
// Expected: (10 * 2) + (100 / 5) = 20 + 20 = 40

// ---------------------------------------------------------
// 5. ADVANCED PRINTING
// ---------------------------------------------------------

// Test Variable Interpolation
STRINGLN Result (Dec): $math_result

// Test Formatting (Hex Uppercase) and Padding
_STR_PRINT_FORMAT = 3
_STR_PRINT_PADDING = 4
STRINGLN Result (HexPad): $math_result

// Reset formatting
_STR_PRINT_FORMAT = 0
_STR_PRINT_PADDING = 0

// ---------------------------------------------------------
// 6. HID & HARDWARE INTERACTION
// ---------------------------------------------------------

// Test Randomization limits
_RANDOM_MIN = 50
_RANDOM_MAX = 60
VAR rand_val = _RANDOM_INT
STRINGLN Random(50-60): $rand_val

// Test Key Combinations and Holds
REM holding shift to select text or type capitals
KEYDOWN SHIFT
STRING test
KEYUP SHIFT
ENTER

// Test Mouse
// Move Right 100, Up 50
MOUSE_MOVE 100 50 
MOUSE_WHEEL -2

// Test Repeat (Should type "Echo" 3 times total)
STRING Echo 
REPEAT 2
ENTER

// Test Persistent Variables (Boot counter)
_GV0 = _GV0 + 1
STRINGLN Boot_Count: $_GV0

// ---------------------------------------------------------
// 7. END OF SCRIPT
// ---------------------------------------------------------
STRINGLN [SUCCESS] Torture test complete.