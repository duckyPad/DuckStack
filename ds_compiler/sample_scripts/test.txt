// =========================================================
// duckyScript Memory Region Stress Test
// Regions: Persistent Global (0xFC00) & VM Reserved (0xFE00)
// =========================================================

STRINGLN_BLOCK
    STARTING MEMORY TEST...
    -----------------------------------
    NOTE: All multi-byte values are Little-Endian.
    FAIL if 'Actual' does not match 'Expected'.
    -----------------------------------
END_STRINGLN

// =========================================================
// SECTION 1: Persistent Global Variables (Start: 0xFC00 / 64512)
// Safe for arbitrary data storage.
// =========================================================

// Define Base Address for Persistent Globals
// 0xFC00 = 64512
VAR p_base = 64512

STRINGLN [TEST 1] 8-BIT SIGNED/UNSIGNED (0xFF) at 0xFC00
// Write 0xFF (255)
POKE8 p_base 255
// Read back
VAR val_s8 = PEEK8(p_base)
VAR val_u8 = PEEKU8(p_base)

STRINGLN Expected Signed: -1
STRINGLN Actual Signed:   $val_s8
STRINGLN Expected Unsigned: 255
STRINGLN Actual Unsigned:   $val_u8
STRINGLN -----------------------------------

STRINGLN [TEST 2] 16-BIT SIGNED/UNSIGNED (0xFFFF) at 0xFC00
// Write 0xFFFF (65535)
POKE16 p_base 65535
// Read back
VAR val_s16 = PEEK16(p_base)
VAR val_u16 = PEEKU16(p_base)

STRINGLN Expected Signed: -1
STRINGLN Actual Signed:   $val_s16
STRINGLN Expected Unsigned: 65535
STRINGLN Actual Unsigned:   $val_u16
STRINGLN -----------------------------------

STRINGLN [TEST 3] 32-BIT INTEGER (0xFFFFFFFF) at 0xFC00
// Write 0xFFFFFFFF (-1)
POKE32 p_base -1
// Read back (Only Signed PEEK32 exists usually, as 32-bit is native width)
VAR val_32 = PEEK32(p_base)

STRINGLN Expected: -1
STRINGLN Actual:   $val_32
STRINGLN -----------------------------------

STRINGLN [TEST 4] LITTLE-ENDIAN BYTE ORDERING
// Write 0xDEADBEEF (Decimal: -559038737) to 0xFC00
// LSB is EF, MSB is DE
POKE32 p_base -559038737

// Read byte-by-byte to verify Little-Endian storage
// 0xFC00 should match LSB (0xEF / 239)
VAR b0 = PEEKU8(p_base)
// 0xFC01 should match (0xBE / 190)
VAR p_base_1 = p_base + 1
VAR b1 = PEEKU8(p_base_1)
// 0xFC02 should match (0xAD / 173)
VAR p_base_2 = p_base + 2
VAR b2 = PEEKU8(p_base_2)
// 0xFC03 should match MSB (0xDE / 222)
VAR p_base_3 = p_base + 3
VAR b3 = PEEKU8(p_base_3)

STRINGLN Expected: EF BE AD DE
STRINGLN Actual:   $b0%02X $b1%02X $b2%02X $b3%02X
STRINGLN -----------------------------------

// =========================================================
// SECTION 2: VM Reserved Variables (Start: 0xFE00 / 65024)
// WARNING: This region maps to VM settings.
// We will test an offset likely unused by critical settings 
// to avoid crashing the VM (0xFEF0).
// =========================================================

// 0xFEF0 = 65264
VAR r_base = 65264

STRINGLN [TEST 5] VM RESERVED REGION WRITE (0xFEF0)
// Write a magic number 12345
POKE32 r_base 12345
VAR r_val = PEEK32(r_base)

STRINGLN Expected: 12345
STRINGLN Actual:   $r_val

STRINGLN -----------------------------------
STRINGLN TESTS COMPLETED.