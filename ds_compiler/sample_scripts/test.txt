REM_BLOCK
    DuckStack Signed vs Unsigned Stress Test
    Targeting 32-bit integer behavior.
    
    Variables used:
    neg_one (-1)     = 0xFFFFFFFF
    pos_one (1)      = 0x00000001
    min_int (INT32_MIN) = 0x80000000
END_REM

// ------------------------------------------
// 1. SETUP VARIABLES
// ------------------------------------------
STRINGLN --- 1. SETUP ---
VAR neg_one = -1
VAR pos_one = 1
// 0x80000000 is -2147483648 in signed decimal
VAR min_int = -2147483648 

// Verify internal representation via Hex
STRINGLN Hex check (Should be ffffffff): $neg_one%x
STRINGLN Hex check (Should be 80000000): $min_int%x

// ------------------------------------------
// 2. COMPARISON: GT vs UGT
// ------------------------------------------
STRINGLN --- 2. COMPARISON ---

// SIGNED CHECK: -1 is LESS than 1
IF neg_one < pos_one
    STRINGLN [PASS] Signed: -1 < 1
ELSE
    STRINGLN [FAIL] Signed: -1 >= 1 (Error in LT opcode)
END_IF

// UNSIGNED CHECK: 0xFFFFFFFF is GREATER than 0x00000001
// Compiler should emit UGT/UGTE/ULT/ULTE here
IF UGT(neg_one, pos_one)
    STRINGLN [PASS] Unsigned: 0xFFFFFFFF > 1
ELSE
    STRINGLN [FAIL] Unsigned: 0xFFFFFFFF <= 1 (Error in UGT opcode)
END_IF

// ------------------------------------------
// 3. DIVISION: DIV vs UDIV
// ------------------------------------------
STRINGLN --- 3. DIVISION ---

VAR div_input = -10
VAR div_by = 2

// Signed Division: -10 / 2 = -5
VAR s_res = div_input / div_by
STRINGLN Signed Div (-10 / 2): $s_res%d

// Unsigned Division: 0xFFFFFFF6 / 2 = 0x7FFFFFB
// This tests if the compiler emits UDIV (0x37) instead of DIV (0x29)
VAR u_res = UDIV(div_input, div_by)
STRINGLN Unsigned Div (-10 / 2): $u_res%x

// ------------------------------------------
// 4. SHIFTING: ASR (>>) vs LSR
// ------------------------------------------
STRINGLN --- 4. SHIFTING ---

VAR shift_target = -4 // 0xFFFFFFFC

// Arithmetic Shift Right (Standard >>)
// Should preserve sign bit (fill with 1s)
// Result: -2 (0xFFFFFFFE)
VAR asr_res = shift_target >> 1
STRINGLN ASR (-4 >> 1): $asr_res%d

// Logical Shift Right (Built-in LSR)
// Should fill with 0s
// Result: 0x7FFFFFFE (2147483646)
VAR lsr_res = LSR(shift_target, 1)
STRINGLN LSR (-4 >> 1): $lsr_res%x

// ------------------------------------------
// 5. PRINT FORMATTING
// ------------------------------------------
STRINGLN --- 5. FORMATTING ---

// Test if %u treats the memory content as unsigned
STRINGLN Signed view: $neg_one%d
STRINGLN Unsigned view: $neg_one%u

STRINGLN --- END TEST ---