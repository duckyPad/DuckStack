REM_BLOCK
  =========================================
  DCE (Dead Code Elimination) Stress Test
  =========================================
  
  EXPECTED OUTCOME:
  -----------------
  [KEPT]      -> keep_entry, keep_nested, keep_recursive
  [ELIMINATED]-> unused_simple, unused_parent, unused_child, unused_recursive
  
  SCENARIOS:
  1. Simple Unused: A function never called.
  2. Unused Chain: Parent calls Child, but Parent is never called.
     (Tests if DCE handles transitive dependencies correctly)
  3. Unused Recursive: Function calls itself, but isn't called by main.
     (Tests if DCE gets tricked by self-reference)
END_REM

// ==========================================
// MAIN EXECUTION PATH (Root of Reachability)
// ==========================================

STRINGLN --- STARTING EXECUTION ---

// 1. Call the entry of a valid chain
keep_entry()

// 2. Call a valid recursive function
VAR math_res = keep_recursive(3)
STRINGLN Recursion Result: $math_res

STRINGLN --- END OF EXECUTION ---
HALT

// ==========================================
// SECTION A: LIVE CODE (Should be KEPT)
// ==========================================

FUN keep_entry()
    STRINGLN [OK] Inside keep_entry
    // Calls another function. DCE must see this link and save 'keep_nested'.
    keep_nested()
END_FUN

FUN keep_nested()
    STRINGLN [OK] Inside keep_nested
END_FUN

FUN keep_recursive(n)
    // Standard recursion. Must be kept.
    IF n <= 1
        RETURN 1
    END_IF
    RETURN n * keep_recursive(n - 1)
END_FUN

// ==========================================
// SECTION B: DEAD CODE (Should be REMOVED)
// ==========================================

// STRESS TEST 1: Simple Isolation
// Simplest case. If this remains, DCE is not working.
FUN unused_simple()
    STRINGLN [FAIL] unused_simple executes!
END_FUN

// STRESS TEST 2: The "Island" Chain
// 'unused_parent' calls 'unused_child'.
// - If DCE just checks "Is this function called by anyone?", 'unused_child' might incorrectly survive.
// - If DCE traces from Main, BOTH should disappear.
FUN unused_parent()
    STRINGLN [FAIL] unused_parent executes!
    unused_child()
END_FUN

FUN unused_child()
    STRINGLN [FAIL] unused_child executes!
END_FUN

// STRESS TEST 3: The "Self-Ref" Cycle
// This function calls itself. 
// A naive reference counter sees RefCount > 0 and keeps it.
// A reachability walker sees no path from Main and deletes it.
FUN unused_recursive(n)
    STRINGLN [FAIL] unused_recursive executes!
    unused_recursive(n)
END_FUN