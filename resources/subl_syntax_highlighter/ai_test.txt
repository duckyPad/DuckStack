%YAML 1.2
---
name: DuckyScript-ai
file_extensions:
  - ducky
  - txt
scope: source.duckyscript

contexts:
  main:
    # --- Block Commands ---
    - match: '\bSTRING_BLOCK\b'
      scope: keyword.control.ducky
      push: 
        - meta_scope: string.quoted.double.ducky
        - match: '\bEND_STRING\b'
          scope: keyword.control.ducky
          pop: true

    - match: '\bSTRINGLN_BLOCK\b'
      scope: keyword.control.ducky
      push: 
        - meta_scope: string.quoted.double.ducky
        - match: '\bEND_STRINGLN\b'
          scope: keyword.control.ducky
          pop: true

    - match: '\bREM_BLOCK\b'
      scope: comment.block.ducky
      push: 
        - meta_scope: comment.block.ducky
        - match: '\bEND_REM\b'
          scope: comment.block.ducky
          pop: true

    # --- Line Comments (Global) ---
    - match: '//|^\s*REM\b'
      scope: comment.line.ducky
      push:
        - meta_scope: comment.line.ducky
        - match: $
          pop: true

    # --- Logic & Flow ---
    - match: '^\s*(WHILE|IF|ELSE\s+IF|VAR)\b'
      scope: keyword.control.ducky
      push: expr_eval

    - match: '\b(END_WHILE|FUNCTION|END_FUNCTION|ELSE|END_IF|THEN)\b'
      scope: keyword.control.ducky

    - match: '\b(GOTO_PROFILE|PREV_PROFILE|NEXT_PROFILE|HALT|LBREAK|CONTINUE|RETURN)\b'
      scope: keyword.control.ducky

    # --- Input Commands ---
    - match: '^\s*(STRINGLN|STRING|OLED_PRINT)\b'
      scope: keyword.other.ducky
      push:
        - meta_scope: string.unquoted.ducky
        - match: '(?=//)|$' # Stop if we see // or end of line
          pop: true

    # --- Numeric/Parameter Commands ---
    - match: '^\s*(DELAY|DEFAULTDELAY|REPEAT|DEFAULTCHARDELAY|CHARJITTER|MOUSE_MOVE|MOUSE_WHEEL|OLED_CURSOR|OLED_CIRCLE|OLED_LINE|OLED_RECT|SWC_SET|SWC_FILL|SWC_RESET|OLED_CLEAR)\b'
      scope: keyword.other.ducky
      push: ds_numeric

    # --- Key States ---
    - match: '^\s*(KEYDOWN|KEYUP)\b'
      scope: keyword.other.ducky
      push: more_keys

    # --- Variables & Defines ---
    - match: '\$[a-zA-Z_][a-zA-Z0-9_]*'
      scope: variable.other.ducky

    - match: '^\s*DEFINE\b'
      scope: keyword.control.ducky

    # --- HID Keys ---
    - match: '^\s*(CTRL|RCTRL|SHIFT|RSHIFT|MK_VOLUP|ALT|RALT|MK_VOLDOWN|WINDOWS|RWINDOWS|MK_MUTE|COMMAND|RCOMMAND|MK_PREV|OPTION|ROPTION|MK_NEXT|ESC|MK_PP|ENTER|MK_STOP|UP|DOWN|LEFT|RIGHT|SPACE|BACKSPACE|NUMLOCK|TAB|KP_SLASH|CAPSLOCK|KP_ASTERISK|PRINTSCREEN|KP_MINUS|SCROLLLOCK|KP_PLUS|PAUSE|KP_ENTER|BREAK|KP_0|KP_1|KP_2|KP_3|KP_4|KP_5|KP_6|KP_7|KP_8|KP_9|INSERT|KP_DOT|HOME|KP_EQUAL|PAGEUP|PAGEDOWN|DELETE|END|ZENKAKUHANKAKU|MENU|HENKAN|POWER|MUHENKAN|F1|F2|F3|F4|F5|F6|F7|F8|F9|F10|F11|F12|F13|F14|F15|F16|F17|F18|F19|F20|F21|F22|F23|F24|KATAKANAHIRAGANA|LMOUSE|RMOUSE|MMOUSE)\b'
      scope: keyword.operator.key.ducky

  # --------- Helper Contexts -----------

  ds_numeric:
    - match: '\b\d+\b'
      scope: constant.numeric.ducky
    - match: '//'
      scope: comment.line.ducky
      set: inline_comment # Switch to comment mode and then pop
    - match: $
      pop: true

  expr_eval:
    - match: '\b(TRUE|FALSE)\b'
      scope: constant.language.boolean.ducky
    - match: '==|!=|>=|<=|=|\+|\-|\*|\/|\&|\^|\%|\!|\>|\<|\|'
      scope: keyword.operator.ducky
    - match: '\b\d+\b'
      scope: constant.numeric.ducky
    - match: '\$[a-zA-Z_][a-zA-Z0-9_]*'
      scope: variable.other.ducky
    - match: '\bTHEN\b'
      scope: keyword.control.ducky
    - match: '//'
      scope: comment.line.ducky
      set: inline_comment
    - match: $
      pop: true

  more_keys:
    - match: '\b(CTRL|RCTRL|SHIFT|RSHIFT|ALT|RALT|WINDOWS|RWINDOWS|COMMAND|RCOMMAND|OPTION|ROPTION)\b'
      scope: keyword.operator.key.ducky
    - match: '//'
      set: inline_comment
    - match: $
      pop: true

  inline_comment:
    - meta_scope: comment.line.ducky
    - match: $
      pop: true